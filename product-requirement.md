# Garmin Training AI Assistant - 產品需求文件

## 1. 產品概述

### 1.1 產品願景
開發一個智能訓練助手，通過分析使用者的 Garmin 運動數據，結合 AI 技術提供個性化的訓練建議和課表安排。這個系統將幫助運動愛好者更好地理解自己的訓練數據，並獲得專業的訓練指導。

### 1.2 目標用戶
- 使用 Garmin 設備記錄運動數據的運動愛好者
  - 業餘跑者
  - 自行車愛好者
  - 游泳愛好者
- 需要專業訓練指導的運動員
  - 競技運動員
  - 業餘比賽參與者
- 希望提升運動表現的健身愛好者
  - 健身愛好者
  - 減重人士
  - 健康管理人士

### 1.3 核心價值
- 數據驅動的訓練建議
  - 基於歷史數據分析
  - 個人化訓練強度建議
  - 訓練效果評估
- 個性化的訓練計劃
  - 根據目標定制計劃
  - 考慮個人能力水平
  - 動態調整訓練強度
- 直觀的數據視覺化
  - 訓練數據圖表展示
  - 進度追蹤
  - 表現趨勢分析
- 智能的 AI 互動
  - 即時訓練建議
  - 問題解答
  - 訓練計劃調整

## 2. 系統架構

### 2.1 前端架構
#### 2.1.1 技術棧詳解
- HTML5
  - 語義化標籤
  - 響應式設計
  - 表單驗證
- CSS3
  - Flexbox 布局
  - Grid 布局
  - 動畫效果
  - 媒體查詢
- JavaScript (ES6+)
  - 模組化開發
  - 非同步處理
  - DOM 操作
  - 事件處理

#### 2.1.2 框架選擇
- React.js
  - 組件化開發
  - 虛擬 DOM
  - 狀態管理 (Redux)
  - 路由管理 (React Router)
- 圖表庫：Chart.js
  - 折線圖配置
  - 柱狀圖配置
  - 熱力圖配置
  - 互動功能
- 日期選擇器：React-Calendar
  - 日期範圍選擇
  - 自定義樣式
  - 事件處理

#### 2.1.3 前端目錄結構
```
frontend/
├── public/
│   ├── index.html
│   └── assets/
├── src/
│   ├── components/
│   │   ├── auth/
│   │   ├── calendar/
│   │   ├── chat/
│   │   └── charts/
│   ├── pages/
│   ├── services/
│   ├── utils/
│   ├── App.js
│   └── index.js
├── package.json
└── README.md
```

### 2.2 後端架構
#### 2.2.1 技術棧詳解
- Python 3.x
  - 非同步處理 (asyncio)
  - 類型提示
  - 虛擬環境管理
- Web 框架：Flask
  - 路由管理
  - 中間件
  - 錯誤處理
  - 請求驗證
- 數據處理
  - pandas: 數據分析
  - numpy: 數值計算
  - scikit-learn: 機器學習
- API 整合
  - Garmin Connect API
  - OpenAI API
  - RESTful API 設計

#### 2.2.2 後端目錄結構
```
backend/
├── app/
│   ├── api/
│   │   ├── auth.py
│   │   ├── activities.py
│   │   └── ai.py
│   ├── models/
│   │   ├── user.py
│   │   └── activity.py
│   ├── services/
│   │   ├── garmin.py
│   │   └── openai.py
│   └── utils/
│       ├── data_processing.py
│       └── validation.py
├── config/
│   ├── development.py
│   └── production.py
├── tests/
├── requirements.txt
└── README.md
```

### 2.3 數據存儲
#### 2.3.1 CSV 文件結構
- 文件命名規範：`user_id_activity_type_YYYYMM.csv`
- 文件組織方式：按用戶ID和活動類型分類
- 備份策略：
  - 每日增量備份
  - 每週完整備份
  - 異地備份

#### 2.3.2 數據目錄結構
```
data/
├── users/
│   ├── user_001/
│   │   ├── running/
│   │   ├── cycling/
│   │   └── swimming/
│   └── user_002/
├── backups/
└── temp/
```

## 3. 功能規格

### 3.1 用戶認證模組
#### 3.1.1 登入介面
- 輸入欄位：
  - Garmin Connect 帳號（電子郵件格式）
  - 密碼（最少8位，包含大小寫字母和數字）
- 功能按鈕：
  - 登入（主要操作按鈕）
  - 重新輸入（清除當前輸入）
  - 忘記密碼（連結到 Garmin 官網）
- 錯誤處理：
  - 輸入格式驗證
  - 登入失敗提示
  - 網路錯誤處理

#### 3.1.2 安全性要求
- 密碼加密存儲
  - 使用 bcrypt 進行密碼雜湊
  - 加鹽處理
  - 定期更新加密算法
- 會話管理
  - JWT token 認證
  - token 過期機制
  - 會話狀態維護
- 登入狀態維護
  - 本地存儲 token
  - 自動登入功能
  - 登出機制

### 3.2 數據獲取模組
#### 3.2.1 Garmin Connect 整合
- 支援的運動類型：
  - 跑步
    - 路跑
    - 越野跑
    - 室內跑步
  - 騎車
    - 公路騎行
    - 山地騎行
    - 室內騎行
  - 游泳
    - 泳池游泳
    - 開放水域
- 數據同步機制
  - 自動同步（每小時）
  - 手動同步
  - 增量同步
- 錯誤處理機制
  - 網路錯誤重試
  - 數據驗證
  - 錯誤日誌記錄

#### 3.2.2 數據轉換
- FIT 檔案解析
  - 使用 fitparse 庫
  - 數據提取
  - 格式轉換
- CSV 格式轉換
  - 數據清洗
  - 格式標準化
  - 缺失值處理
- 數據驗證
  - 格式檢查
  - 範圍檢查
  - 一致性檢查

### 3.3 日曆選擇模組
#### 3.3.1 介面設計
- 月曆視圖
  - 當前月份顯示
  - 月份切換
  - 年份選擇
- 運動日期標記
  - 不同運動類型不同顏色
  - 運動強度標記
  - 懸停顯示詳情
- 日期範圍選擇
  - 開始日期選擇
  - 結束日期選擇
  - 範圍驗證

#### 3.3.2 功能特點
- 運動日期高亮顯示
  - 顏色編碼
  - 強度指示
  - 互動效果
- 拖拽選擇日期範圍
  - 拖拽操作
  - 範圍限制
  - 即時反饋
- 快速選擇常用時間範圍
  - 最近一週
  - 最近一個月
  - 最近三個月
  - 自定義範圍

### 3.4 AI 對話模組
#### 3.4.1 對話介面
- 聊天窗口
  - 消息氣泡
  - 時間戳
  - 滾動加載
- 輸入框
  - 多行輸入
  - 表情支持
  - 快捷回覆
- 發送按鈕
  - 狀態指示
  - 快捷操作
- 歷史記錄顯示
  - 分頁加載
  - 搜索功能
  - 導出功能

#### 3.4.2 AI 功能
- 訓練建議生成
  - 基於歷史數據
  - 考慮目標設定
  - 適應性調整
- 數據分析解讀
  - 趨勢分析
  - 表現評估
  - 改進建議
- 目標設定建議
  - 短期目標
  - 長期目標
  - 進度追蹤
- 訓練計劃調整
  - 動態調整
  - 強度控制
  - 恢復建議

### 3.5 數據視覺化模組
#### 3.5.1 圖表類型
- 折線圖
  - 心率變化
  - 配速變化
  - 距離累積
  - 互動功能
- 柱狀圖
  - 訓練量分布
  - 強度分布
  - 比較分析
- 熱力圖
  - 訓練強度分布
  - 時間分布
  - 地理分布

#### 3.5.2 數據展示
- 訓練課表視圖
  - 日曆視圖
  - 列表視圖
  - 詳細信息
- 運動數據詳情
  - 基本數據
  - 進階指標
  - 比較分析
- 進度追蹤
  - 目標完成度
  - 趨勢分析
  - 預測分析

## 4. 技術需求

### 4.1 開發環境
- Python 3.x
  - 版本：3.8+
  - 虛擬環境：venv
  - 包管理：pip
- Node.js
  - 版本：16+
  - 包管理：npm/yarn
- Git 版本控制
  - 分支策略
  - 提交規範
  - 代碼審查
- VS Code 開發環境
  - 推薦插件
  - 代碼格式化
  - 調試配置

### 4.2 依賴套件
```python
# Python 套件
garminconnect==0.1.50  # Garmin Connect API 整合
pandas==2.0.0          # 數據處理和分析
numpy==1.24.0          # 數值計算
flask==2.0.0           # Web 框架
openai==0.27.0         # OpenAI API 整合
fitparse==1.2.0        # FIT 檔案解析
matplotlib==3.7.0      # 數據可視化
seaborn==0.12.0        # 統計圖表
python-dotenv==0.19.0  # 環境變量管理
pytest==7.0.0          # 單元測試
black==22.0.0          # 代碼格式化
flake8==4.0.0          # 代碼檢查

# JavaScript 套件
react==18.2.0          # UI 框架
react-dom==18.2.0      # React DOM 操作
chart.js==4.0.0        # 圖表庫
react-calendar==4.0.0  # 日曆組件
axios==0.27.0          # HTTP 客戶端
redux==4.2.0           # 狀態管理
react-router==6.3.0    # 路由管理
styled-components==5.3.0 # CSS-in-JS
```

### 4.3 API 需求
- Garmin Connect API
  - 認證方式：OAuth 2.0
  - 請求限制：每小時 1000 次
  - 數據範圍：活動數據、用戶資料
- OpenAI API
  - 認證方式：API Key
  - 模型：GPT-4
  - 使用限制：根據配額
- 自定義 API
  - RESTful 設計
  - 版本控制
  - 錯誤處理

## 5. 數據結構

### 5.1 CSV 格式規範
```csv
activity_id,date,activity_type,duration,distance,avg_heart_rate,max_heart_rate,calories,avg_pace,avg_speed,training_effect,aerobic_effect,anaerobic_effect,steps,cadence,swim_strokes,swim_cadence,pool_length,pool_laps
```

### 5.2 數據欄位說明
- activity_id: 活動唯一識別碼（UUID 格式）
- date: 活動日期時間（ISO 8601 格式）
- activity_type: 活動類型（running/cycling/swimming）
- duration: 活動時長（秒，整數）
- distance: 距離（米，浮點數）
- avg_heart_rate: 平均心率（bpm，整數）
- max_heart_rate: 最大心率（bpm，整數）
- calories: 消耗卡路里（kcal，整數）
- avg_pace: 平均配速（秒/公里，浮點數）
- avg_speed: 平均速度（公里/小時，浮點數）
- training_effect: 訓練效果（0-5，浮點數）
- aerobic_effect: 有氧效果（0-5，浮點數）
- anaerobic_effect: 無氧效果（0-5，浮點數）
- steps: 步數（跑步，整數）
- cadence: 步頻（跑步，步/分鐘，整數）
- swim_strokes: 划水次數（游泳，整數）
- swim_cadence: 划水頻率（游泳，次/分鐘，整數）
- pool_length: 泳池長度（游泳，米，整數）
- pool_laps: 泳池圈數（游泳，整數）

## 6. 安全性要求

### 6.1 數據安全
- 使用者認證資料加密
  - 密碼雜湊：bcrypt
  - 加鹽處理
  - 定期更新
- 運動數據加密存儲
  - 傳輸加密：TLS 1.3
  - 存儲加密：AES-256
  - 密鑰管理
- 定期數據備份
  - 自動備份
  - 異地備份
  - 備份驗證

### 6.2 API 安全
- API 金鑰安全存儲
  - 環境變量
  - 加密存儲
  - 定期輪換
- 請求頻率限制
  - IP 限制
  - 用戶限制
  - 異常檢測
- 錯誤處理機制
  - 日誌記錄
  - 警報系統
  - 自動恢復

## 7. 效能要求

### 7.1 響應時間
- 頁面載入：< 2秒
  - 首次載入
  - 頁面切換
  - 數據更新
- 數據同步：< 5秒
  - 活動同步
  - 數據處理
  - 狀態更新
- AI 回應：< 3秒
  - 問題處理
  - 建議生成
  - 數據分析

### 7.2 並發處理
- 支援多用戶同時使用
  - 用戶隔離
  - 資源分配
  - 負載均衡
- 數據處理優化
  - 緩存機制
  - 異步處理
  - 批量處理
- 資源使用效率
  - CPU 使用率
  - 記憶體管理
  - 磁盤 I/O

## 8. 開發時程

### 8.1 第一階段（基礎架構）- 4週
- 專案初始化
  - 環境搭建
  - 代碼規範
  - 版本控制
- 基本框架搭建
  - 前端框架
  - 後端框架
  - 數據庫設計
- 核心功能實現
  - 用戶認證
  - 數據同步
  - 基本 UI

### 8.2 第二階段（功能開發）- 6週
- 用戶介面開發
  - 頁面設計
  - 組件開發
  - 交互優化
- 數據處理模組
  - 數據解析
  - 數據轉換
  - 數據驗證
- AI 整合
  - API 對接
  - 功能實現
  - 測試優化

### 8.3 第三階段（優化與測試）- 4週
- 性能優化
  - 代碼優化
  - 數據庫優化
  - 緩存優化
- 用戶體驗改進
  - 界面優化
  - 交互優化
  - 響應優化
- 系統測試
  - 單元測試
  - 集成測試
  - 性能測試

## 9. 維護計劃

### 9.1 日常維護
- 系統監控
  - 性能監控
  - 錯誤監控
  - 使用統計
- 錯誤修復
  - 問題追蹤
  - 修復流程
  - 版本更新
- 性能優化
  - 定期檢查
  - 優化建議
  - 實施計劃

### 9.2 更新計劃
- 定期功能更新
  - 新功能開發
  - 功能優化
  - 用戶反饋
- 安全性更新
  - 安全補丁
  - 漏洞修復
  - 安全審計
- 用戶反饋處理
  - 問題收集
  - 需求分析
  - 改進實施

## 10. 開發指南

### 10.1 代碼規範
- Python 代碼規範
  - PEP 8 標準
  - 文檔字符串
  - 類型提示
- JavaScript 代碼規範
  - ESLint 配置
  - 命名規範
  - 註釋規範

### 10.2 測試規範
- 單元測試
  - 測試覆蓋率
  - 測試用例
  - 測試報告
- 集成測試
  - 接口測試
  - 功能測試
  - 性能測試

### 10.3 文檔規範
- 代碼文檔
  - 函數文檔
  - 類文檔
  - 模塊文檔
- 用戶文檔
  - 使用手冊
  - API 文檔
  - 部署文檔

---
*文件版本：1.0.0*
*最後更新：2024-03-21*
*作者：AI Assistant* 